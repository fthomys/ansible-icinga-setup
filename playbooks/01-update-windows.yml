- name: Install Windows Updates on Windows agents
  hosts: windows-agents
  become: true
  become_method: runas
  become_user: Administrator
  gather_facts: false

  tasks:
    - name: Search and install all available Windows updates
      ansible.windows.win_updates:
        category_names:
          - SecurityUpdates
          - CriticalUpdates
          - UpdateRollups
          - DefinitionUpdates
        reboot: yes
        reboot_timeout: 1800
      register: win_updates_result

    - name: Display installed updates summary
      ansible.builtin.debug:
        msg: |
          Installed: {{ win_updates_result.updates | length }}
          Updates installed: {{ win_updates_result.updates | map(attribute='title') | list | join(', ') }}
